/*
 * @Date: 2025-10-11 15:00:09
 * @LastEditors: ReBeX cswwwx@gmail.com
 * @LastEditTime: 2025-10-11 15:03:44
 * @FilePath: /mapbox-csw/src/utils/tool/mergeCircle.js
 * @Description: 拟合并且合并圆
 */

import * as turf from '@turf/turf'

// 计算两圆外切线及其切点
function getTangents(c1x, c1y, r1, c2x, c2y, r2) {
  const res = []
  const dx = c2x - c1x
  const dy = c2y - c1y
  const d = Math.sqrt(dx * dx + dy * dy)
  if (d === 0)
    return []

  const vx = dx / d
  const vy = dy / d

  // 只计算外切线
  const c = (r1 - r2) / d
  if (c * c > 1)
    return []

  const h = Math.sqrt(Math.max(0, 1 - c * c))
  for (const sign2 of [1, -1]) {
    const nx = vx * c - sign2 * h * vy
    const ny = vy * c + sign2 * h * vx
    const x1 = c1x + r1 * nx
    const y1 = c1y + r1 * ny
    const x2 = c2x + r2 * nx
    const y2 = c2y + r2 * ny
    res.push([x1, y1, x2, y2])
  }
  return res
}

// 判断角度是否在 start 和 end 之间（考虑 2π 周期）
function isBetween(target, start, end) {
  if (end > 2 * Math.PI) {
    return target >= start || target <= end - 2 * Math.PI
  }
  return target >= start && target <= end
}

// 生成圆弧上的点
function generateArcPoints(cx, cy, r, startAngle, endAngle, numPoints = 32) {
  if (endAngle < startAngle)
    endAngle += 2 * Math.PI
  const points = []
  const step = (endAngle - startAngle) / (numPoints - 1)
  for (let i = 0; i < numPoints; i++) {
    const angle = startAngle + i * step
    const x = cx + r * Math.cos(angle)
    const y = cy + r * Math.sin(angle)
    points.push([x, y])
  }
  return points
}

// 从多边形坐标计算圆心和半径
function getCircleCenterAndRadius(coordinates) {
  let sumX = 0
  let sumY = 0
  const n = coordinates.length
  for (const [x, y] of coordinates) {
    sumX += x
    sumY += y
  }
  const cx = sumX / n
  const cy = sumY / n

  // 计算平均半径
  let sumR = 0
  for (const [x, y] of coordinates) {
    const dx = x - cx
    const dy = y - cy
    sumR += Math.sqrt(dx * dx + dy * dy)
  }
  const r = sumR / n
  return { cx, cy, r }
}

// 合并两个圆为一个 Polygon
function mergeTwoCircles(circle1, circle2) {
  const { cx: c1x, cy: c1y, r: r1 } = circle1
  const { cx: c2x, cy: c2y, r: r2 } = circle2

  // 计算外切线
  const tangents = getTangents(c1x, c1y, r1, c2x, c2y, r2)
  if (tangents.length < 2) {
    throw new Error('无法计算外切线，可能圆相交或重叠')
  }

  // 按 y 坐标排序，上切线先
  tangents.sort((a, b) => (b[1] + b[3]) / 2 - (a[1] + a[3]) / 2)
  const upperT = tangents[0]
  const lowerT = tangents[1]
  const c1Upper = [upperT[0], upperT[1]]
  const c2Upper = [upperT[2], upperT[3]]
  const c1Lower = [lowerT[0], lowerT[1]]
  const c2Lower = [lowerT[2], lowerT[3]]

  // 计算切点角度
  const angleC1Upper = Math.atan2(c1Upper[1] - c1y, c1Upper[0] - c1x)
  const angleC1Lower = Math.atan2(c1Lower[1] - c1y, c1Lower[0] - c1x)
  const angleC2Upper = Math.atan2(c2Upper[1] - c2y, c2Upper[0] - c2x)
  const angleC2Lower = Math.atan2(c2Lower[1] - c2y, c2Lower[0] - c2x)

  const polygon = []

  // 从圆1下切点开始
  polygon.push(c1Lower)
  polygon.push(c2Lower)

  // 圆2外弧（从下切点到上切点）
  let startAngle = angleC2Lower
  let endAngle = angleC2Upper
  if (endAngle < startAngle)
    endAngle += 2 * Math.PI
  let span = endAngle - startAngle
  let angleToOther = Math.atan2(c1y - c2y, c1x - c2x)
  if (isBetween(angleToOther, startAngle, endAngle)) {
    endAngle = startAngle + (2 * Math.PI - span)
  }
  const arcPoints2 = generateArcPoints(c2x, c2y, r2, startAngle, endAngle)
  polygon.push(...arcPoints2.slice(1))

  polygon.push(c1Upper)

  // 圆1外弧（从上切点到下切点）
  startAngle = angleC1Upper
  endAngle = angleC1Lower
  if (endAngle < startAngle)
    endAngle += 2 * Math.PI
  span = endAngle - startAngle
  angleToOther = Math.atan2(c2y - c1y, c2x - c1x)
  if (isBetween(angleToOther, startAngle, endAngle)) {
    endAngle = startAngle + (2 * Math.PI - span)
  }
  const arcPoints1 = generateArcPoints(c1x, c1y, r1, startAngle, endAngle)
  polygon.push(...arcPoints1.slice(1))

  // 闭合多边形
  polygon.push(polygon[0])

  // 返回合并后的多边形坐标
  return polygon
}

// 主函数：合并多个圆为一个 Polygon
export function mergeCircles(geojson) {
  // 如果只有一个或零个要素，直接返回
  if (geojson.features.length <= 1) {
    return geojson.features[0]?.geometry || { type: 'Polygon', coordinates: [] }
  }

  // 提取所有圆的坐标并计算圆心和半径
  const circles = geojson.features.map((feature) => {
    const coords = feature.geometry.coordinates[0]
    return getCircleCenterAndRadius(coords)
  })

  // 存储每两个相邻圆合并后的多边形
  const mergedPolygons = []

  // 两两合并相邻的圆
  for (let i = 0; i < circles.length - 1; i++) {
    const current = circles[i]
    const next = circles[i + 1]
    const merged = mergeTwoCircles(current, next)
    mergedPolygons.push(merged)
  }

  // 如果没有合并出任何多边形，返回空
  if (mergedPolygons.length === 0) {
    return { type: 'Polygon', coordinates: [] }
  }

  // 如果只合并出一个多边形，直接返回
  if (mergedPolygons.length === 1) {
    return {
      type: 'Polygon',
      coordinates: [mergedPolygons[0]],
    }
  }
  const featureCollection = turf.featureCollection(mergedPolygons.map(item => turf.polygon([item])))

  return turf.union(featureCollection)
}

// 输入你的 GeoJSON 数据
const inputGeoJSON = {
  type: 'FeatureCollection',
  features: [
    {
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [
              37.35515077534445,
              13.862374360667973,
            ],
            [
              37.32217106945905,
              13.860799168290308,
            ],
            [
              37.28951029676255,
              13.85608882486908,
            ],
            [
              37.25748426699286,
              13.848288882298252,
            ],
            [
              37.22640257516709,
              13.83747476447189,
            ],
            [
              37.19656557427444,
              13.823751028766972,
            ],
            [
              37.168261442921725,
              13.807250342802972,
            ],
            [
              37.141763377754536,
              13.788132187000544,
            ],
            [
              37.11732693895683,
              13.766581296241728,
            ],
            [
              37.095187575288996,
              13.742805856550651,
            ],
            [
              37.07555835299255,
              13.717035475138097,
            ],
            [
              37.05862791050787,
              13.689518944359136,
            ],
            [
              37.04455865836111,
              13.660521822099616,
            ],
            [
              37.03348524082033,
              13.630323852816538,
            ],
            [
              37.02551327304172,
              13.599216254896884,
            ],
            [
              37.0207183644665,
              13.567498901159514,
            ],
            [
              37.01914543622828,
              13.535477420200944,
            ],
            [
              37.0208083373249,
              13.503460246876395,
            ],
            [
              37.02568976133418,
              13.471755650514103,
            ],
            [
              37.033741462537336,
              13.44066876948879,
            ],
            [
              37.04488476748553,
              13.410498680536005,
            ],
            [
              37.05901137532496,
              13.381535530682532,
            ],
            [
              37.075984437604205,
              13.354057758910129,
            ],
            [
              37.09563990583913,
              13.32832943367308,
            ],
            [
              37.11778813281826,
              13.304597731168187,
            ],
            [
              37.14221571150581,
              13.283090577823682,
            ],
            [
              37.168687533448306,
              13.264014478846411,
            ],
            [
              37.19694904681975,
              13.247552552861237,
            ],
            [
              37.22672869265651,
              13.23386279070924,
            ],
            [
              37.25774049643811,
              13.22307655436004,
            ],
            [
              37.28968679096995,
              13.21529732965582,
            ],
            [
              37.32226104551859,
              13.210599744259326,
            ],
            [
              37.35515077534445,
              13.209028859743809,
            ],
            [
              37.388040505170295,
              13.210599744259326,
            ],
            [
              37.42061475971893,
              13.21529732965582,
            ],
            [
              37.45256105425078,
              13.22307655436004,
            ],
            [
              37.48357285803238,
              13.23386279070924,
            ],
            [
              37.513352503869136,
              13.247552552861237,
            ],
            [
              37.541614017240576,
              13.264014478846411,
            ],
            [
              37.56808583918308,
              13.283090577823682,
            ],
            [
              37.59251341787063,
              13.304597731168187,
            ],
            [
              37.614661644849754,
              13.32832943367308,
            ],
            [
              37.634317113084684,
              13.354057758910129,
            ],
            [
              37.65129017536393,
              13.381535530682532,
            ],
            [
              37.665416783203355,
              13.410498680536005,
            ],
            [
              37.67656008815155,
              13.44066876948879,
            ],
            [
              37.68461178935471,
              13.471755650514103,
            ],
            [
              37.68949321336399,
              13.503460246876395,
            ],
            [
              37.69115611446061,
              13.535477420200944,
            ],
            [
              37.689583186222386,
              13.567498901159514,
            ],
            [
              37.684788277647165,
              13.599216254896884,
            ],
            [
              37.67681630986855,
              13.630323852816538,
            ],
            [
              37.66574289232778,
              13.660521822099616,
            ],
            [
              37.651673640181016,
              13.689518944359136,
            ],
            [
              37.63474319769634,
              13.717035475138097,
            ],
            [
              37.61511397539989,
              13.742805856550651,
            ],
            [
              37.59297461173206,
              13.766581296241728,
            ],
            [
              37.56853817293435,
              13.788132187000544,
            ],
            [
              37.542040107767164,
              13.807250342802972,
            ],
            [
              37.51373597641445,
              13.823751028766972,
            ],
            [
              37.4838989755218,
              13.83747476447189,
            ],
            [
              37.45281728369602,
              13.848288882298252,
            ],
            [
              37.42079125392634,
              13.85608882486908,
            ],
            [
              37.38813048122984,
              13.860799168290308,
            ],
            [
              37.35515077534445,
              13.862374360667973,
            ],
          ],
        ],
      },
    },
    {
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [
              37.96636134425148,
              13.753128133621942,
            ],
            [
              37.944796160738186,
              13.752098144374713,
            ],
            [
              37.92343922336052,
              13.749018123027371,
            ],
            [
              37.902496750812,
              13.743917811911793,
            ],
            [
              37.882170927298674,
              13.736846459719434,
            ],
            [
              37.862657936054575,
              13.727872342111962,
            ],
            [
              37.84414605312132,
              13.71708209734227,
            ],
            [
              37.8268138204129,
              13.704579883559001,
            ],
            [
              37.81082831619495,
              13.690486366243046,
            ],
            [
              37.79634354001966,
              13.674937545904863,
            ],
            [
              37.783498927891394,
              13.65808343773816,
            ],
            [
              37.77241801201168,
              13.640086616363368,
            ],
            [
              37.76320723788787,
              13.621120640088272,
            ],
            [
              37.75595494990888,
              13.601368370252024,
            ],
            [
              37.75073055471686,
              13.581020202192015,
            ],
            [
              37.747583869859234,
              13.560272225173643,
            ],
            [
              37.74654466331276,
              13.539324329244959,
            ],
            [
              37.747622387553776,
              13.518378277418842,
            ],
            [
              37.750806109925925,
              13.497635761842727,
            ],
            [
              37.75606463914982,
              13.477296462691276,
            ],
            [
              37.76334684594525,
              13.457556128412836,
            ],
            [
              37.772582173913364,
              13.438604695679965,
            ],
            [
              37.783681335068145,
              13.420624466943602,
            ],
            [
              37.79653718272763,
              13.403788362875883,
            ],
            [
              37.81102575288686,
              13.388258266216576,
            ],
            [
              37.82700746370741,
              13.374183472621299,
            ],
            [
              37.84432846138183,
              13.361699263056039,
            ],
            [
              37.86282209937227,
              13.350925611102923,
            ],
            [
              37.88231053688872,
              13.341966037247806,
            ],
            [
              37.90260644146893,
              13.334906620823386,
            ],
            [
              37.92351477965334,
              13.329815178794505,
            ],
            [
              37.94483467901926,
              13.326740619008447,
            ],
            [
              37.96636134425148,
              13.325712473905584,
            ],
            [
              37.987888009483704,
              13.326740619008447,
            ],
            [
              38.009207908849625,
              13.329815178794505,
            ],
            [
              38.03011624703402,
              13.334906620823386,
            ],
            [
              38.05041215161424,
              13.341966037247806,
            ],
            [
              38.0699005891307,
              13.35092561110292,
            ],
            [
              38.088394227121135,
              13.361699263056039,
            ],
            [
              38.10571522479555,
              13.374183472621299,
            ],
            [
              38.12169693561611,
              13.388258266216576,
            ],
            [
              38.13618550577532,
              13.403788362875883,
            ],
            [
              38.14904135343482,
              13.420624466943602,
            ],
            [
              38.1601405145896,
              13.438604695679965,
            ],
            [
              38.16937584255771,
              13.457556128412836,
            ],
            [
              38.17665804935315,
              13.477296462691276,
            ],
            [
              38.18191657857704,
              13.497635761842727,
            ],
            [
              38.18510030094919,
              13.518378277418842,
            ],
            [
              38.1861780251902,
              13.539324329244959,
            ],
            [
              38.18513881864373,
              13.560272225173643,
            ],
            [
              38.1819921337861,
              13.581020202192015,
            ],
            [
              38.17676773859408,
              13.601368370252024,
            ],
            [
              38.169515450615094,
              13.621120640088272,
            ],
            [
              38.16030467649128,
              13.640086616363368,
            ],
            [
              38.14922376061157,
              13.65808343773816,
            ],
            [
              38.1363791484833,
              13.674937545904863,
            ],
            [
              38.12189437230802,
              13.690486366243046,
            ],
            [
              38.10590886809006,
              13.704579883559001,
            ],
            [
              38.08857663538164,
              13.71708209734227,
            ],
            [
              38.07006475244838,
              13.72787234211196,
            ],
            [
              38.05055176120429,
              13.736846459719434,
            ],
            [
              38.030225937690965,
              13.743917811911793,
            ],
            [
              38.00928346514245,
              13.749018123027371,
            ],
            [
              37.98792652776478,
              13.752098144374713,
            ],
            [
              37.96636134425148,
              13.753128133621942,
            ],
          ],
        ],
      },
    },
    {
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [
              38.36944230912013,
              13.717446810789617,
            ],
            [
              38.352389594459936,
              13.716632375832699,
            ],
            [
              38.335501457387174,
              13.714196931274001,
            ],
            [
              38.31894087687749,
              13.710163981691371,
            ],
            [
              38.30286765061682,
              13.70457244761516,
            ],
            [
              38.287436844016156,
              13.69747628753664,
            ],
            [
              38.27279728632931,
              13.688943974004497,
            ],
            [
              38.25909012876846,
              13.679057829024115,
            ],
            [
              38.2464474788368,
              13.667913225365378,
            ],
            [
              38.234991124271694,
              13.655617661703717,
            ],
            [
              38.22483135902838,
              13.642289720752244,
            ],
            [
              38.216065922645335,
              13.628057920677584,
            ],
            [
              38.208779063134436,
              13.613059471117236,
            ],
            [
              38.203040732246734,
              13.597438946022342,
            ],
            [
              38.198905920594996,
              13.581346886328495,
            ],
            [
              38.19641413868435,
              13.5649383461022,
            ],
            [
              38.19558904842841,
              13.548371396317085,
            ],
            [
              38.19643824822819,
              13.531805600778377,
            ],
            [
              38.198953213179514,
              13.515400478935193,
            ],
            [
              38.203109390468576,
              13.499313970397266,
            ],
            [
              38.20886644852819,
              13.483700915907264,
            ],
            [
              38.216168677073476,
              13.468711569314301,
            ],
            [
              38.22494553372741,
              13.45449015475227,
            ],
            [
              38.235112331596106,
              13.441173482753218,
            ],
            [
              38.24657106087016,
              13.428889638426895,
            ],
            [
              38.259211336322544,
              13.41775675411986,
            ],
            [
              38.2729114614527,
              13.4078818781385,
            ],
            [
              38.287539598998755,
              13.399359950188735,
            ],
            [
              38.30295503661071,
              13.392272893159879,
            ],
            [
              38.31900953565379,
              13.386688829770833,
            ],
            [
              38.335548750396065,
              13.382661431413872,
            ],
            [
              38.35241370423344,
              13.38022940528489,
            ],
            [
              38.36944230912013,
              13.379416124590746,
            ],
            [
              38.38647091400682,
              13.38022940528489,
            ],
            [
              38.403335867844206,
              13.382661431413872,
            ],
            [
              38.41987508258647,
              13.386688829770833,
            ],
            [
              38.43592958162955,
              13.392272893159879,
            ],
            [
              38.451345019241515,
              13.399359950188735,
            ],
            [
              38.46597315678757,
              13.4078818781385,
            ],
            [
              38.47967328191773,
              13.41775675411986,
            ],
            [
              38.4923135573701,
              13.428889638426895,
            ],
            [
              38.50377228664416,
              13.441173482753218,
            ],
            [
              38.513939084512856,
              13.45449015475227,
            ],
            [
              38.522715941166794,
              13.468711569314301,
            ],
            [
              38.53001816971207,
              13.483700915907264,
            ],
            [
              38.53577522777169,
              13.499313970397266,
            ],
            [
              38.53993140506074,
              13.515400478935193,
            ],
            [
              38.54244637001207,
              13.531805600778377,
            ],
            [
              38.54329556981186,
              13.548371396317085,
            ],
            [
              38.542470479555924,
              13.5649383461022,
            ],
            [
              38.539978697645275,
              13.581346886328495,
            ],
            [
              38.535843885993536,
              13.597438946022342,
            ],
            [
              38.53010555510583,
              13.613059471117236,
            ],
            [
              38.52281869559493,
              13.628057920677584,
            ],
            [
              38.514053259211884,
              13.642289720752244,
            ],
            [
              38.50389349396856,
              13.655617661703717,
            ],
            [
              38.49243713940346,
              13.667913225365378,
            ],
            [
              38.47979448947179,
              13.679057829024115,
            ],
            [
              38.466087331910956,
              13.688943974004497,
            ],
            [
              38.4514477742241,
              13.69747628753664,
            ],
            [
              38.436016967623445,
              13.70457244761516,
            ],
            [
              38.41994374136277,
              13.710163981691371,
            ],
            [
              38.40338316085309,
              13.714196931274001,
            ],
            [
              38.386495023780334,
              13.716632375832699,
            ],
            [
              38.36944230912013,
              13.717446810789617,
            ],
          ],
        ],
      },
    },
    {
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [
              38.77949624008244,
              13.690640563827104,
            ],
            [
              38.76740024776886,
              13.69006291567995,
            ],
            [
              38.75542092273819,
              13.688335542769545,
            ],
            [
              38.74367380187085,
              13.685475105702867,
            ],
            [
              38.73227217239642,
              13.681509192737135,
            ],
            [
              38.721325974835175,
              13.676476052507795,
            ],
            [
              38.71094073893094,
              13.670424223546474,
            ],
            [
              38.70121656302812,
              13.6634120642407,
            ],
            [
              38.69224714688938,
              13.655507187863815,
            ],
            [
              38.68411888739001,
              13.646785808231732,
            ],
            [
              38.676910045870606,
              13.637332002413046,
            ],
            [
              38.67068999518654,
              13.62723689772207,
            ],
            [
              38.66551855367275,
              13.616597790952694,
            ],
            [
              38.661445412353864,
              13.605517208457545,
            ],
            [
              38.658509660784404,
              13.594101916235964,
            ],
            [
              38.65673941591169,
              13.582461889660687,
            ],
            [
              38.65615155732683,
              13.57070925284324,
            ],
            [
              38.65675157121853,
              13.558957197908807,
            ],
            [
              38.658533504279774,
              13.547318894621377,
            ],
            [
              38.661480027751736,
              13.535906400868154,
            ],
            [
              38.66556261073081,
              13.524829584479322,
            ],
            [
              38.67074180082542,
              13.514195066726048,
            ],
            [
              38.67696760923666,
              13.50410519760884,
            ],
            [
              38.6841799963615,
              13.494657072722426,
            ],
            [
              38.69230945308612,
              13.485941601066752,
            ],
            [
              38.701277672057905,
              13.478042632670427,
            ],
            [
              38.710998302404704,
              13.47103615430875,
            ],
            [
              38.72137778061479,
              13.464989560938898,
            ],
            [
              38.73231622960681,
              13.459961009746541,
            ],
            [
              38.74370841740946,
              13.455998862908004,
            ],
            [
              38.75544476634127,
              13.453141224327387,
            ],
            [
              38.767412403133996,
              13.451415574716655,
            ],
            [
              38.77949624008244,
              13.45083850845667,
            ],
            [
              38.791580077030886,
              13.451415574716655,
            ],
            [
              38.80354771382361,
              13.453141224327387,
            ],
            [
              38.81528406275542,
              13.455998862908004,
            ],
            [
              38.826676250558066,
              13.459961009746541,
            ],
            [
              38.837614699550095,
              13.464989560938898,
            ],
            [
              38.84799417776017,
              13.47103615430875,
            ],
            [
              38.85771480810697,
              13.478042632670427,
            ],
            [
              38.866683027078764,
              13.485941601066752,
            ],
            [
              38.87481248380338,
              13.494657072722426,
            ],
            [
              38.88202487092822,
              13.50410519760884,
            ],
            [
              38.88825067933945,
              13.514195066726048,
            ],
            [
              38.89342986943406,
              13.524829584479322,
            ],
            [
              38.897512452413146,
              13.535906400868154,
            ],
            [
              38.900458975885094,
              13.547318894621377,
            ],
            [
              38.90224090894635,
              13.558957197908807,
            ],
            [
              38.902840922838045,
              13.57070925284324,
            ],
            [
              38.90225306425318,
              13.582461889660687,
            ],
            [
              38.90048281938047,
              13.594101916235964,
            ],
            [
              38.89754706781102,
              13.605517208457545,
            ],
            [
              38.89347392649213,
              13.616597790952694,
            ],
            [
              38.88830248497833,
              13.62723689772207,
            ],
            [
              38.88208243429427,
              13.637332002413046,
            ],
            [
              38.87487359277487,
              13.646785808231732,
            ],
            [
              38.866745333275496,
              13.655507187863815,
            ],
            [
              38.85777591713675,
              13.6634120642407,
            ],
            [
              38.848051741233945,
              13.670424223546474,
            ],
            [
              38.83766650532969,
              13.676476052507795,
            ],
            [
              38.82672030776845,
              13.681509192737135,
            ],
            [
              38.81531867829403,
              13.685475105702867,
            ],
            [
              38.803571557426686,
              13.688335542769545,
            ],
            [
              38.79159223239601,
              13.69006291567995,
            ],
            [
              38.77949624008244,
              13.690640563827104,
            ],
          ],
        ],
      },
    },
    {
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [
              39.16179195981613,
              13.692132003395272,
            ],
            [
              39.15363601936354,
              13.691742580525393,
            ],
            [
              39.14555870528929,
              13.69057806611796,
            ],
            [
              39.13763788365608,
              13.688649686475506,
            ],
            [
              39.1299499073383,
              13.685976031444039,
            ],
            [
              39.122568877958805,
              13.682582874666187,
            ],
            [
              39.11556592984981,
              13.678502924403434,
            ],
            [
              39.10900854302666,
              13.673775507364798,
            ],
            [
              39.10295989186677,
              13.668446188632648,
            ],
            [
              39.09747823582212,
              13.662566331398066,
            ],
            [
              39.09261635806639,
              13.65619260080207,
            ],
            [
              39.088421057492795,
              13.649386416719349,
            ],
            [
              39.0849326989412,
              13.642213360812535,
            ],
            [
              39.08218482594876,
              13.634742543622997,
            ],
            [
              39.080203839695024,
              13.627045937844194,
            ],
            [
              39.07900874715549,
              13.619197684242762,
            ],
            [
              39.078610980794885,
              13.611273376947489,
            ],
            [
              39.079014291430454,
              13.603349335015459,
            ],
            [
              39.08021471518226,
              13.595501867306035,
            ],
            [
              39.08220061471066,
              13.587806537746767,
            ],
            [
              39.08495279422617,
              13.58033743806009,
            ],
            [
              39.088444687052096,
              13.573166474937041,
            ],
            [
              39.092642613830975,
              13.566362678494723,
            ],
            [
              39.09750610879895,
              13.55999153864031,
            ],
            [
              39.102988310913666,
              13.55411437568787,
            ],
            [
              39.109036416015584,
              13.548787751238725,
            ],
            [
              39.11559218563675,
              13.544062924944123,
            ],
            [
              39.12259250754731,
              13.53998536232545,
            ],
            [
              39.12997000265488,
              13.536594298335693,
            ],
            [
              39.13765367244719,
              13.53392236081142,
            ],
            [
              39.14556958079888,
              13.531995257392172,
            ],
            [
              39.153641563650595,
              13.530831528879201,
            ],
            [
              39.16179195981613,
              13.530442371373423,
            ],
            [
              39.16994235598166,
              13.530831528879201,
            ],
            [
              39.17801433883338,
              13.531995257392172,
            ],
            [
              39.18593024718506,
              13.53392236081142,
            ],
            [
              39.19361391697738,
              13.536594298335693,
            ],
            [
              39.200991412084946,
              13.53998536232545,
            ],
            [
              39.207991733995506,
              13.544062924944123,
            ],
            [
              39.21454750361667,
              13.548787751238725,
            ],
            [
              39.22059560871859,
              13.55411437568787,
            ],
            [
              39.2260778108333,
              13.55999153864031,
            ],
            [
              39.23094130580128,
              13.566362678494723,
            ],
            [
              39.23513923258016,
              13.57316647493704,
            ],
            [
              39.23863112540609,
              13.58033743806009,
            ],
            [
              39.2413833049216,
              13.587806537746767,
            ],
            [
              39.24336920444999,
              13.595501867306035,
            ],
            [
              39.2445696282018,
              13.603349335015459,
            ],
            [
              39.24497293883737,
              13.611273376947489,
            ],
            [
              39.24457517247677,
              13.619197684242762,
            ],
            [
              39.24338007993723,
              13.627045937844194,
            ],
            [
              39.2413990936835,
              13.634742543622997,
            ],
            [
              39.238651220691054,
              13.642213360812535,
            ],
            [
              39.23516286213946,
              13.649386416719349,
            ],
            [
              39.23096756156587,
              13.65619260080207,
            ],
            [
              39.226105683810125,
              13.662566331398066,
            ],
            [
              39.22062402776549,
              13.668446188632648,
            ],
            [
              39.214575376605595,
              13.673775507364798,
            ],
            [
              39.20801798978245,
              13.678502924403434,
            ],
            [
              39.20101504167345,
              13.682582874666187,
            ],
            [
              39.193634012293955,
              13.685976031444039,
            ],
            [
              39.185946035976166,
              13.688649686475506,
            ],
            [
              39.178025214342966,
              13.69057806611796,
            ],
            [
              39.16994790026872,
              13.691742580525393,
            ],
            [
              39.16179195981613,
              13.692132003395272,
            ],
          ],
        ],
      },
    },
  ],
}

console.log('输出结果', mergeCircles(inputGeoJSON))
